import { IncomingMessage, ServerResponse } from 'http';

interface SourceData {
    mtime?: Date;
    maxAge?: number;
    getData: () => Promise<Buffer>;
}
declare type Source = (src: string) => Promise<SourceData>;
declare type SourceFactory = (options?: any) => Source;

interface ImageMeta {
    width: number;
    height: number;
    type: string;
    mimeType: string;
}
interface IPXInputOptions {
    source?: string;
    modifiers?: Record<string, string>;
}
interface IPXCTX {
    sources: Record<string, Source>;
}
declare type IPX = (id: string, opts?: IPXInputOptions) => {
    src: () => Promise<SourceData>;
    data: () => Promise<{
        data: Buffer;
        meta: ImageMeta;
        format: string;
    }>;
};
interface IPXOptions {
    dir?: false | string;
    domains?: false | string[];
    sharp?: {
        [key: string]: any;
    };
}
declare function createIPX(userOptions: Partial<IPXOptions>): IPX;

declare function createIPXMiddleware(ipx: IPX): (req: IncomingMessage, res: ServerResponse) => void;

export { IPX, IPXCTX, IPXInputOptions, IPXOptions, ImageMeta, Source, SourceData, SourceFactory, createIPX, createIPXMiddleware };
